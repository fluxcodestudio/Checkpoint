---
phase: 19-ai-tool-artifact-backup
type: execute
---

<objective>
Add automatic detection and backup of AI coding tool artifacts (.claude/, .cursor/, .aider, .windsurf/, etc.) to the backup engine, even when gitignored.

Purpose: AI tool config, rules, memory, and history are highly valuable but typically gitignored. Losing them means losing project knowledge, custom rules, and session history across 14 AI coding tools.
Output: BACKUP_AI_ARTIFACTS config flag wired end-to-end, AI artifact detection in backup-now.sh, detected tools shown in checkpoint status.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-ai-tool-artifact-backup/19-RESEARCH.md

# Key source files:
@lib/core/config.sh
@bin/backup-now.sh
@bin/checkpoint.sh
@templates/backup-config.sh
@templates/global-config-template.sh
@templates/backup-config.yaml

**Established patterns:**
- Critical files block in backup-now.sh (lines 757-813): config flag → find/check → append to $changed_files
- Config variable pattern: BACKUP_* flags with defaults via ${VAR:-default}
- Global config: DEFAULT_BACKUP_* in global-config-template.sh, parsed in config.sh
- YAML mapping: config_key_to_var() and config_var_to_key() bidirectional in config.sh
- YAML template: patterns.include section in backup-config.yaml

**Key constraints from research:**
- Add to $changed_files (NOT $filtered_files) — must go through filtering pipeline
- Use find with -type f for directories (rsync --files-from needs individual file paths)
- Exclude cache dirs: .aider.tags.cache.v*, .cursor/ indexing, .windsurf/ cache
- Target specific subdirs: .cursor/rules/ not .cursor/, .windsurf/rules/ not .windsurf/
- No find -printf (macOS BSD), no associative arrays (Bash 3.2+)
- Use $((var + 1)) not ((var++)) for set -e compatibility
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add BACKUP_AI_ARTIFACTS config infrastructure</name>
  <files>lib/core/config.sh, templates/backup-config.sh, templates/global-config-template.sh, templates/backup-config.yaml</files>
  <action>
Add BACKUP_AI_ARTIFACTS config variable following the exact pattern of BACKUP_ENV_FILES, BACKUP_CREDENTIALS, BACKUP_IDE_SETTINGS:

1. **lib/core/config.sh** — Three additions:
   a. In apply_global_config() case block (after line 67 DEFAULT_BACKUP_IDE_SETTINGS): Add `DEFAULT_BACKUP_AI_ARTIFACTS) : "${BACKUP_AI_ARTIFACTS:=$value}" ;;`
   b. In final fallbacks section (after line 99 BACKUP_IDE_SETTINGS): Add `: "${BACKUP_AI_ARTIFACTS:=true}"`
   c. In config_key_to_var() (after line 312 backup_targets.local_databases): Add `"backup_targets.ai_artifacts") echo "BACKUP_AI_ARTIFACTS" ;;`
   d. In config_var_to_key() (after line 350 BACKUP_LOCAL_DATABASES): Add `"BACKUP_AI_ARTIFACTS") echo "backup_targets.ai_artifacts" ;;`

Also add optional extra dirs/files variables:
   e. In final fallbacks: Add `: "${AI_ARTIFACT_EXTRA_DIRS:=}"` and `: "${AI_ARTIFACT_EXTRA_FILES:=}"`

2. **templates/backup-config.sh** — After BACKUP_LOCAL_DATABASES=true (line 150), before the cloud section:
   ```
   # AI Tool Artifacts — include .claude/, .cursor/, .aider, .windsurf/ etc.
   BACKUP_AI_ARTIFACTS=true
   # Extra directories to include (comma-separated, relative to project root)
   AI_ARTIFACT_EXTRA_DIRS=""
   # Extra files to include (comma-separated, relative to project root)
   AI_ARTIFACT_EXTRA_FILES=""
   ```

3. **templates/global-config-template.sh** — After DEFAULT_BACKUP_IDE_SETTINGS=true (line 53):
   ```
   # Backup AI coding tool artifacts (.claude/, .cursor/, .aider, etc.) by default
   DEFAULT_BACKUP_AI_ARTIFACTS=true
   ```

4. **templates/backup-config.yaml** — After local_databases: true (line 113), inside patterns.include:
   ```
   # Backup AI coding tool artifacts (.claude/, .cursor/, .aider, .windsurf/, etc.)
   ai_artifacts: true
   ```
  </action>
  <verify>grep -n "BACKUP_AI_ARTIFACTS" lib/core/config.sh templates/backup-config.sh templates/global-config-template.sh && grep -n "ai_artifacts" templates/backup-config.yaml</verify>
  <done>BACKUP_AI_ARTIFACTS variable exists in all 4 config files with correct defaults (true), bidirectional YAML mapping works, global config override parsing works</done>
</task>

<task type="auto">
  <name>Task 2: Add AI artifact detection to backup engine</name>
  <files>bin/backup-now.sh</files>
  <action>
Insert AI artifact detection block after line 813 (after `.backup-config.sh` always-include) and before line 815 (the `if [ ! -s "$changed_files" ]` empty check). Follow the exact "critical files" pattern from lines 757-813.

The block must:
1. Check `BACKUP_AI_ARTIFACTS` flag (default true)
2. Scan known AI tool DIRECTORIES via `find -type f` (outputs individual files for rsync --files-from):
   - .claude (all files — small, mostly valuable)
   - .cursor/rules (NOT all of .cursor/ — indexing cache is large)
   - .windsurf/rules (NOT all of .windsurf/ — cache is large)
   - .clinerules (directory form)
   - .continue
   - .codex
   - .augment
   - .amazonq
   - .aiassistant
   - memory-bank (Cline Memory Bank)
   - cline_docs (alternative Cline Memory Bank name)
3. Check known AI tool INDIVIDUAL FILES:
   - Cross-tool: CLAUDE.md, AGENTS.md, QODO.md, CONVENTIONS.md
   - Aider: .aider.chat.history.md, .aider.input.history, .aider.conf.yml, .aider.model.settings.yml, .aiderignore
   - Cursor: .cursorrules, .cursorignore, .cursorindexingignore
   - Windsurf: .windsurfrules, .codeiumignore
   - Cline: .clineignore
   - Continue: .continuerc.json, .continuerc.js, .continuerc.ts
   - Copilot: .github/copilot-instructions.md
   - JetBrains: .aiignore
   - Qodo: .pr_agent.toml
   - Tabnine: .tabnine, .tabnine_commands
4. Check .github/instructions/ for Copilot path-specific instructions (*.instructions.md)
5. Process AI_ARTIFACT_EXTRA_DIRS (comma-separated) and AI_ARTIFACT_EXTRA_FILES (comma-separated)
6. Skip .DS_Store files in directory scans
7. Log count of AI artifact files added
8. Use `_ai_count=$((ai_count + 1))` pattern (NOT ((var++))) for set -e compatibility
9. Use `find "$dir" -type f 2>/dev/null` (no -printf, macOS compatible)
10. Append all found files to "$changed_files" (NOT $filtered_files)

Add section comment header following the codebase convention:
```bash
# ==============================================================================
# Include AI coding tool artifacts (even if gitignored)
# ==============================================================================
```
  </action>
  <verify>grep -c "BACKUP_AI_ARTIFACTS" bin/backup-now.sh && grep -c "_ai_count" bin/backup-now.sh && grep "\.claude" bin/backup-now.sh | head -3</verify>
  <done>AI artifact detection block inserted in backup-now.sh between line 813 (backup-config.sh) and the empty-check. Block detects 14 AI tools, excludes cache directories, processes extra dirs/files, logs count. All paths appended to $changed_files.</done>
</task>

<task type="auto">
  <name>Task 3: Show detected AI tools in checkpoint status</name>
  <files>bin/checkpoint.sh</files>
  <action>
In the show_command_center() function, after the "Project Status" line (around line 103) and before the blank echo on line 105, add AI tool detection display:

```bash
# Detect AI coding tools in project
_detected_tools=""
[ -d ".claude" ] && _detected_tools="${_detected_tools}Claude Code, "
[ -d ".cursor" ] && _detected_tools="${_detected_tools}Cursor, "
[ -f ".aider.conf.yml" ] || [ -f ".aider.chat.history.md" ] && _detected_tools="${_detected_tools}Aider, "
[ -d ".windsurf" ] && _detected_tools="${_detected_tools}Windsurf, "
[ -f ".clinerules" ] || [ -d ".clinerules" ] && _detected_tools="${_detected_tools}Cline, "
[ -d ".continue" ] || [ -f ".continuerc.json" ] && _detected_tools="${_detected_tools}Continue, "
[ -d ".codex" ] && _detected_tools="${_detected_tools}Codex CLI, "
[ -d ".augment" ] && _detected_tools="${_detected_tools}Augment, "
[ -d ".amazonq" ] && _detected_tools="${_detected_tools}Amazon Q, "
[ -d ".aiassistant" ] && _detected_tools="${_detected_tools}JetBrains AI, "
[ -f ".github/copilot-instructions.md" ] && _detected_tools="${_detected_tools}Copilot, "
[ -n "$_detected_tools" ] && echo "AI Tools Detected: ${_detected_tools%, }"
```

Only show the line if at least one AI tool is detected. Strip trailing ", " from the list.

Important: This should display regardless of whether the project is configured — AI tools exist at the directory level, not the backup config level.
  </action>
  <verify>grep -c "_detected_tools" bin/checkpoint.sh && grep "Claude Code" bin/checkpoint.sh</verify>
  <done>checkpoint --status shows "AI Tools Detected: Claude Code, Cursor, ..." line when AI tools are present in the project directory. Line hidden when no tools detected.</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `grep -r "BACKUP_AI_ARTIFACTS" lib/ templates/ bin/` shows config in all expected files
- [ ] `grep "ai_artifacts" templates/backup-config.yaml` shows YAML mapping
- [ ] `bash -n bin/backup-now.sh` — no syntax errors
- [ ] `bash -n bin/checkpoint.sh` — no syntax errors
- [ ] `bash -n lib/core/config.sh` — no syntax errors
- [ ] AI artifact block is between .backup-config.sh include and empty-file check in backup-now.sh
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No syntax errors in modified scripts
- BACKUP_AI_ARTIFACTS=true by default in all config layers (bash template, YAML template, global config, config.sh defaults)
- Config bidirectional mapping works (backup_targets.ai_artifacts ↔ BACKUP_AI_ARTIFACTS)
- AI artifact detection covers all 14 tools from research
- Cache directories excluded (.aider.tags.cache.*, full .cursor/, full .windsurf/)
- Extra dirs/files support via AI_ARTIFACT_EXTRA_DIRS and AI_ARTIFACT_EXTRA_FILES
- checkpoint status shows detected AI tools
</success_criteria>

<output>
After completion, create `.planning/phases/19-ai-tool-artifact-backup/19-01-SUMMARY.md`:

# Phase 19 Plan 1: AI Tool Artifact Backup Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- `file` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 19 complete, ready for Phase 20.
</output>
