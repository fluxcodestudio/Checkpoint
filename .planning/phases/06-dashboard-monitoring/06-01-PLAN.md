---
phase: 06-dashboard-monitoring
plan: 01
type: execute
---

<objective>
Create a global status bar indicator showing backup health across all projects.

Purpose: Provide instant visibility into backup system health without opening any tools.
Output: A status daemon with CLI command, tmux integration, and macOS menu bar support.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (relevant to dashboard work):
@.planning/phases/05-tiered-retention/05-01-SUMMARY.md

# Existing infrastructure to build on:
@lib/dashboard-status.sh
@lib/projects-registry.sh
@integrations/lib/notification.sh
@integrations/tmux/backup-tmux-status.sh

**Tech stack available:** Pure bash, dialog/whiptail, osascript, tmux
**Established patterns:**
- Status functions in lib/dashboard-status.sh
- Project iteration via projects-registry.sh list_projects()
- Notification via integrations/lib/notification.sh

**Constraining decisions:**
- Pure bash implementation (no Python/Node for core)
- macOS only for v1
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create global status aggregation library</name>
  <files>lib/global-status.sh</files>
  <action>
Create library that aggregates health across ALL registered projects:
- get_global_health() - returns "healthy|warning|error" based on worst project
- get_global_summary() - returns compact string: "✅ 5 projects OK" or "⚠ 2/5 need backup"
- get_all_projects_status() - returns one line per project with name, health, last backup age
- Source projects-registry.sh and iterate list_projects()
- For each project: load its .backup-config.sh, check backup age, check for errors in log
- Health logic: >24h without backup = warning, >72h = error, recent log errors = error

Avoid hardcoding paths - use PROJECT_DIR from each project's config.
Why: Projects may have custom backup directories.
  </action>
  <verify>source lib/global-status.sh && get_global_summary && get_all_projects_status</verify>
  <done>Functions return aggregated status across all registered projects</done>
</task>

<task type="auto">
  <name>Task 2: Create status indicator CLI command</name>
  <files>bin/backup-indicator.sh</files>
  <action>
Create CLI command for status indicator with multiple output formats:
- backup-indicator.sh --emoji - Just emoji (✅/⚠/❌) for minimal UIs
- backup-indicator.sh --compact - "✅ 5 OK" or "⚠ 2/5"
- backup-indicator.sh --verbose - Full multi-line status per project
- backup-indicator.sh --json - JSON output for external tools
- backup-indicator.sh --daemon - Run as background daemon, updating status file every 60s

Daemon mode writes status to ~/.config/checkpoint/status.json with:
{ "health": "healthy", "summary": "5 OK", "projects": [...], "updated": epoch }

Exit codes: 0=healthy, 1=warning, 2=error (useful for shell integration).
  </action>
  <verify>./bin/backup-indicator.sh --emoji && ./bin/backup-indicator.sh --compact && ./bin/backup-indicator.sh --verbose</verify>
  <done>CLI outputs status in all formats, exit codes reflect health</done>
</task>

<task type="auto">
  <name>Task 3: Update tmux integration for global status</name>
  <files>integrations/tmux/backup-tmux-status.sh</files>
  <action>
Update existing tmux status script to use new global status:
- Replace per-project check with global aggregation
- Add format option: @backup-status-format = emoji|compact|verbose
- Read from status.json if daemon running (faster), fall back to direct check
- Show aggregated health: ✅ when all projects healthy, ⚠ when any warning, ❌ when any error
- Preserve existing format compatibility for users who already have it configured
  </action>
  <verify>./integrations/tmux/backup-tmux-status.sh (in tmux session)</verify>
  <done>Tmux status bar shows global backup health across all projects</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `source lib/global-status.sh && get_global_summary` returns aggregated status
- [ ] `./bin/backup-indicator.sh --emoji` returns single emoji
- [ ] `./bin/backup-indicator.sh --json` returns valid JSON
- [ ] Exit codes match health: 0=healthy, 1=warning, 2=error
- [ ] Tmux status shows global health (test in tmux session)
</verification>

<success_criteria>

- Global status library aggregates health across all registered projects
- CLI command provides multiple output formats (emoji, compact, verbose, JSON)
- Daemon mode available for continuous status updates
- Tmux integration shows global health in status bar
- All existing patterns maintained (pure bash, macOS compatible)
</success_criteria>

<output>
After completion, create `.planning/phases/06-dashboard-monitoring/06-01-SUMMARY.md`
</output>
