---
phase: 06-dashboard-monitoring
plan: 03
type: execute
---

<objective>
Enhance restore interface with point-in-time capability for sub-minute recovery.

Purpose: Enable users to restore any file to any point in time from the last week.
Output: Enhanced restore wizard with timeline view and point-in-time selection.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plans in this phase:
@.planning/phases/06-dashboard-monitoring/06-01-SUMMARY.md
@.planning/phases/06-dashboard-monitoring/06-02-SUMMARY.md

# Existing infrastructure:
@bin/backup-restore.sh
@lib/retention-policy.sh
@lib/dashboard-ui.sh

**Tech stack available:** Pure bash, dialog/whiptail
**Established patterns:**
- Restore wizard in bin/backup-restore.sh
- Timestamp extraction via lib/retention-policy.sh extract_timestamp()
- TUI dialogs via lib/dashboard-ui.sh

**Constraining decisions:**
- Sub-minute restore = restore to any point in last week from available snapshots
- Backup architecture: files/ (current), archived/ (timestamped versions)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add point-in-time file listing</name>
  <files>lib/restore-lib.sh</files>
  <action>
Create restore library with point-in-time functions:

- list_file_versions(filepath) - List all versions of a file with timestamps
  Returns: timestamp|size|path for each version
  Sources: current in files/, all in archived/ matching the file

- list_files_at_time(target_time) - List all files as they existed at a point in time
  For each file in files/ and archived/:
  - Find version closest to (but before) target_time
  - Return: filepath|timestamp|size|source_path

- find_closest_version(filepath, target_time) - Get version closest to target
  Returns: path to the backup file that was current at target_time

Timestamp parsing uses extract_timestamp() from retention-policy.sh.
Handle archived filename format: name.ext.YYYYMMDD_HHMMSS_XXXX

Time parsing should accept:
- Epoch seconds
- "YYYY-MM-DD HH:MM:SS"
- Relative: "2 hours ago", "yesterday 3pm"
  </action>
  <verify>source lib/restore-lib.sh && list_file_versions "src/main.js" (in a project with backups)</verify>
  <done>Functions return file versions and point-in-time snapshots</done>
</task>

<task type="auto">
  <name>Task 2: Add timeline view to restore wizard</name>
  <files>bin/backup-restore.sh</files>
  <action>
Enhance restore wizard with timeline mode:

backup-restore.sh timeline [filepath]

Timeline display format:
```
═══════════════════════════════════════════════════════════
  File Timeline: src/components/App.tsx
═══════════════════════════════════════════════════════════

  Today
    • 10:45:32  [current]  12.4 KB
    • 10:32:15             12.1 KB  (+300 bytes)
    • 09:15:00             11.8 KB

  Yesterday
    • 18:22:41             11.5 KB
    • 14:30:12             10.2 KB
    • 09:00:00             10.2 KB

  Jan 9
    • 16:45:00             9.8 KB
    • 11:20:33             9.5 KB

  [Older versions available - use --all to show]

  Enter version number to restore, or:
    [d] Diff between versions
    [p] Preview version content
    [q] Cancel
```

Features:
- Group versions by day for readability
- Show size delta between versions
- Limit to recent by default, --all for full history
- Support diff between any two versions (using diff command)
- Preview mode shows file content
  </action>
  <verify>./bin/backup-restore.sh timeline (in project with archived files)</verify>
  <done>Timeline view shows file history grouped by day with restore options</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Enhanced restore wizard with timeline view and point-in-time restore</what-built>
  <how-to-verify>
    1. Navigate to a project with backups: cd /path/to/project
    2. Run: ./bin/backup-restore.sh timeline src/some-file.ts
    3. Verify: Timeline shows file versions grouped by day
    4. Select a version number and verify restore preview works
    5. Test diff: select [d] and compare two versions
    6. Test: ./bin/backup-restore.sh file src/some-file.ts --at "2 hours ago"
    7. Confirm: Correct version is identified and restore prompt appears
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `list_file_versions` returns all versions of a file
- [ ] `list_files_at_time` returns snapshot at specific time
- [ ] Timeline view displays versions grouped by day
- [ ] Diff between versions works
- [ ] --at flag restores file to point in time
- [ ] Human verified restore workflow
</verification>

<success_criteria>

- Point-in-time restore library provides file version listing
- Timeline view shows file history in readable grouped format
- Users can restore any file to any backed-up point in time
- Diff capability for comparing versions
- Human verified the restore workflow works correctly
- Phase 6 complete - all dashboard & monitoring features implemented
</success_criteria>

<output>
After completion, create `.planning/phases/06-dashboard-monitoring/06-03-SUMMARY.md` with:
- Phase 6 completion summary
- All dashboard features implemented
- Ready for milestone completion
</output>
