---
phase: 13-native-file-watcher
plan: 04
type: execute
---

<objective>
Remove Claude Code hooks and update install/uninstall scripts to eliminate all hook-related code.

Purpose: Complete the decoupling from Claude Code by removing hook files, hook setup code, and hook templates — making Checkpoint fully editor-agnostic.
Output: Hook files deleted, install/uninstall/install-global scripts cleaned of hook code, templates/claude-settings.json deleted.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Research (critical — hook removal scope, install.sh details):
@.planning/phases/13-native-file-watcher/13-RESEARCH.md

# Previous plan summaries:
@.planning/phases/13-native-file-watcher/13-01-SUMMARY.md
@.planning/phases/13-native-file-watcher/13-02-SUMMARY.md
@.planning/phases/13-native-file-watcher/13-03-SUMMARY.md

# Key source files:
@bin/install.sh
@bin/uninstall.sh
@bin/install-global.sh
@.claude/hooks/backup-on-edit.sh
@.claude/hooks/backup-on-commit.sh
@.claude/hooks/backup-on-stop.sh
@bin/smart-backup-trigger.sh
@templates/claude-settings.json

**Tech stack available:** Bash 3.2+
**Constraining decisions:**
- RESEARCH hook_removal_scope: Complete inventory of files to delete and sections to modify
- RESEARCH install_script_details: Exact line ranges for 7 sections in install.sh
- smart-backup-trigger.sh logic already migrated to backup-watcher.sh (Plan 02)
- Watcher LaunchAgent installation STAYS (KEEP cross-platform aware)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete hook files and smart-backup-trigger.sh</name>
  <files>.claude/hooks/backup-on-edit.sh, .claude/hooks/backup-on-commit.sh, .claude/hooks/backup-on-stop.sh, bin/smart-backup-trigger.sh, templates/claude-settings.json</files>
  <action>
Delete the following 5 files — their functionality has been replaced:

1. `.claude/hooks/backup-on-edit.sh` (19 lines) — Triggered on Claude Code file edits. Replaced by native file watcher.
2. `.claude/hooks/backup-on-commit.sh` (16 lines) — Triggered on Claude Code git commits. Replaced by native file watcher detecting commit-related file changes.
3. `.claude/hooks/backup-on-stop.sh` (20 lines) — Triggered on Claude Code conversation end. Replaced by debounce-based backup (last file changes trigger backup after quiet period).
4. `bin/smart-backup-trigger.sh` (98 lines) — Session detection + interval enforcement. Logic migrated to backup-watcher.sh in Plan 02.
5. `templates/claude-settings.json` (38 lines) — Hook configuration template for .claude/settings.local.json. No longer needed.

Use `git rm` for tracked files, `rm` for untracked files.

Verify the .claude/hooks/ directory is empty after deletion, then remove it: `rmdir .claude/hooks/` (only if empty — don't force-remove if other files exist).

Note: Do NOT delete `.claude/` directory itself — it may contain other config files.
  </action>
  <verify>
test ! -f .claude/hooks/backup-on-edit.sh (deleted)
test ! -f .claude/hooks/backup-on-commit.sh (deleted)
test ! -f .claude/hooks/backup-on-stop.sh (deleted)
test ! -f bin/smart-backup-trigger.sh (deleted)
test ! -f templates/claude-settings.json (deleted)
test ! -d .claude/hooks (directory removed if empty)
  </verify>
  <done>
All 5 hook-related files deleted, .claude/hooks/ directory removed (if empty), smart-backup-trigger.sh gone (logic lives in backup-watcher.sh now)
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove hook-related code from install.sh, uninstall.sh, and install-global.sh</name>
  <files>bin/install.sh, bin/uninstall.sh, bin/install-global.sh</files>
  <action>
**bin/install.sh (~1383 lines) — Remove these sections (see RESEARCH install_script_details):**

Read the file first and locate each section by searching for these markers:

1. **Hook installation question (Q4):** Search for "HOOKS_ENABLED" or "hooks" in the interactive question section. Remove the question asking about Claude Code hooks.

2. **`.claude/hooks` directory creation:** Search for `mkdir.*\.claude/hooks` or `.claude/hooks`. Remove all occurrences of hooks directory creation.

3. **Hook script copying:** Search for `backup-on-edit\|backup-on-commit\|backup-on-stop` and `cp.*hooks/`. Remove all hook file copy operations.

4. **HOOKS_ENABLED logic block:** Search for the if-block checking `HOOKS_ENABLED`. Remove the entire conditional block.

5. **settings.local.json hook configuration:** Search for `settings.local.json` or `PostToolUse\|Stop` event configuration. Remove the settings.json generation block that configures Claude Code hooks.

6. **Old global hooks migration:** Search for `~/.claude/hooks` or global hooks migration code. Remove migration logic.

7. **KEEP the watcher LaunchAgent installation** — Do NOT remove plist installation. Only remove hook-related code.

**bin/uninstall.sh (~263 lines):**
Search for and remove:
- Hook script deletion code (search for `backup-on-edit\|backup-on-commit\|backup-on-stop\|\.claude/hooks`)
- jq-based hook removal from settings.json (search for `jq.*hooks\|settings\.local\.json.*hook`)
- `.claude/hooks` directory cleanup

**bin/install-global.sh (~591 lines):**
Search for and remove:
- Entire "SESSION-START HOOKS" section (search for `SESSION-START\|session.start\|hook`)
- Hook installation within session-start (search for `backup-on\|hooks`)

**CRITICAL:** Read each file FIRST before editing. The line numbers from RESEARCH are approximate — search by content patterns, not line numbers. Ensure surrounding code still makes sense after removal (no dangling else, unclosed if-blocks, etc.).

**IMPORTANT:** Do NOT remove comments or code unrelated to hooks. Preserve all watcher, daemon, LaunchAgent, and general installation code.
  </action>
  <verify>
bash -n bin/install.sh (syntax check passes — no unclosed blocks)
bash -n bin/uninstall.sh (syntax check passes)
bash -n bin/install-global.sh (syntax check passes)
grep -c "HOOKS_ENABLED\|hooks_enabled\|backup-on-edit\|backup-on-commit\|backup-on-stop\|HOOKS_TRIGGERS\|claude-settings\.json" bin/install.sh (should be 0 or minimal non-functional references)
grep -c "HOOKS_ENABLED\|backup-on-edit\|backup-on-commit\|backup-on-stop" bin/uninstall.sh (should be 0)
grep -c "SESSION-START.*HOOK\|backup-on-\|hooks" bin/install-global.sh (should be 0 or minimal)
grep "WATCHER_ENABLED\|LaunchAgent\|watcher" bin/install.sh (watcher code preserved)
  </verify>
  <done>
All hook-related code removed from install.sh, uninstall.sh, install-global.sh. All three scripts pass bash -n syntax check. Watcher/LaunchAgent installation code preserved. No HOOKS_ENABLED, HOOKS_TRIGGERS, backup-on-*, or claude-settings.json references remain in install scripts.
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 5 hook files deleted
- [ ] `bash -n bin/install.sh` passes
- [ ] `bash -n bin/uninstall.sh` passes
- [ ] `bash -n bin/install-global.sh` passes
- [ ] No hook references remain in install scripts (grep verification)
- [ ] Watcher/LaunchAgent installation code preserved
- [ ] No dangling if-else blocks or syntax errors introduced
- [ ] Phase 13 complete — all 4 plans done
</verification>

<success_criteria>

- All 5 hook files deleted
- 3 install scripts cleaned of hook code
- All scripts pass bash -n syntax check
- Watcher installation preserved
- Phase 13 complete: native file watcher with cross-platform support, session detection, 8 bug fixes, hooks removed, config updated
</success_criteria>

<output>
After completion, create `.planning/phases/13-native-file-watcher/13-04-SUMMARY.md`:

This is the final plan in Phase 13. The summary should also include "Phase 13 complete" and readiness for Phase 14.
</output>
