---
phase: 09-configuration-ux
plan: 02
type: execute
---

<objective>
Enhance the setup wizard with cloud folder, alerts, and Claude hooks sections.

Purpose: Guide users through complete configuration including v1.0 and v1.1 features.
Output: Enhanced mode_wizard() in bin/backup-config.sh covering all major features.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-configuration-ux/09-01-SUMMARY.md

**Prior wizard scope:**
- Project name, database, retention, backup frequency, drive verification, critical files

**Missing from wizard:**
- Cloud folder setup (most impactful v1.0 feature)
- Alert/notification preferences (Phase 8)
- Claude hooks setup (Phase 3)

**Source files:**
@bin/backup-config.sh (mode_wizard function, lines ~366-490)
@lib/cloud-backup.sh (cloud folder detection)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add cloud folder setup section to wizard</name>
  <files>bin/backup-config.sh</files>
  <action>
In mode_wizard(), after the "Critical Files" section and before applying core settings, add:

```bash
# Cloud folder
echo ""
color_cyan "Cloud Backup"
echo ""
echo "Cloud folder backup syncs via your desktop app (Dropbox, Google Drive, iCloud)."
echo "This is the recommended backup destination for automatic cloud protection."
echo ""

if confirm "Enable cloud folder backup? (recommended)" "y"; then
    # Try to detect cloud folder
    local detected_folder
    detected_folder="$(detect_cloud_folder 2>/dev/null || echo "")"

    if [[ -n "$detected_folder" ]]; then
        echo ""
        color_green "Detected cloud folder: $detected_folder"
        if confirm "Use detected folder?" "y"; then
            config_set_value "cloud_folder.enabled" "true"
            config_set_value "cloud_folder.path" "$detected_folder"
        else
            local custom_path
            custom_path="$(prompt "Enter cloud folder path" "$HOME/Dropbox/Backups/Checkpoint")"
            config_set_value "cloud_folder.enabled" "true"
            config_set_value "cloud_folder.path" "$custom_path"
        fi
    else
        echo ""
        color_yellow "No cloud folder auto-detected."
        local cloud_path
        cloud_path="$(prompt "Enter cloud folder path (or leave empty to skip)" "")"
        if [[ -n "$cloud_path" ]]; then
            config_set_value "cloud_folder.enabled" "true"
            config_set_value "cloud_folder.path" "$cloud_path"
        else
            config_set_value "cloud_folder.enabled" "false"
        fi
    fi

    if [[ "$(config_get_value "cloud_folder.enabled" 2>/dev/null)" == "true" ]]; then
        if confirm "Also keep local backup copy?" "y"; then
            config_set_value "cloud_folder.also_local" "true"
        else
            config_set_value "cloud_folder.also_local" "false"
        fi
    fi
else
    config_set_value "cloud_folder.enabled" "false"
fi
```

The detect_cloud_folder function already exists in lib/cloud-backup.sh - verify it's sourced or add fallback.
  </action>
  <verify>grep -q "Cloud Backup" bin/backup-config.sh && grep -q "detect_cloud_folder" bin/backup-config.sh</verify>
  <done>Wizard includes cloud folder setup section with auto-detection</done>
</task>

<task type="auto">
  <name>Task 2: Add alert and notification preferences section</name>
  <files>bin/backup-config.sh</files>
  <action>
In mode_wizard(), after the cloud folder section, add:

```bash
# Alerts and notifications
echo ""
color_cyan "Alerts & Notifications"
echo ""
echo "Configure when to receive backup status notifications."
echo ""

echo "When should you be warned about stale backups?"
echo "  1) After 12 hours (aggressive)"
echo "  2) After 24 hours (recommended)"
echo "  3) After 48 hours (relaxed)"
local warning_choice
warning_choice="$(prompt "Select option [1-3]" "2")"

local warning_hours=24
case "$warning_choice" in
    "1") warning_hours=12 ;;
    "2") warning_hours=24 ;;
    "3") warning_hours=48 ;;
esac
config_set_value "alerts.warning_hours" "$warning_hours"

# Error threshold is typically 3x warning
local error_hours=$((warning_hours * 3))
config_set_value "alerts.error_hours" "$error_hours"

echo ""
if confirm "Enable quiet hours? (suppress notifications during sleep)" "n"; then
    echo ""
    echo "Quiet hours format: START-END in 24-hour time"
    echo "Example: 22-07 (10pm to 7am)"
    local quiet_hours
    quiet_hours="$(prompt "Enter quiet hours" "22-07")"
    config_set_value "alerts.quiet_hours" "$quiet_hours"
else
    config_set_value "alerts.quiet_hours" ""
fi
```

Keep it concise - don't expose every notification option, just the important ones.
  </action>
  <verify>grep -q "Alerts & Notifications" bin/backup-config.sh && grep -q "quiet hours" bin/backup-config.sh</verify>
  <done>Wizard includes alert thresholds and quiet hours configuration</done>
</task>

<task type="auto">
  <name>Task 3: Add optional Claude hooks setup section</name>
  <files>bin/backup-config.sh</files>
  <action>
In mode_wizard(), after alerts section, add:

```bash
# Claude Code hooks (optional)
echo ""
color_cyan "Claude Code Integration (Optional)"
echo ""
echo "Automatically trigger backups from Claude Code events."
echo "Requires Claude Code CLI to be installed."
echo ""

# Check if claude command exists
if command -v claude &>/dev/null; then
    if confirm "Enable Claude Code backup hooks?" "y"; then
        config_set_value "hooks.enabled" "true"

        echo ""
        echo "Which events should trigger backups?"
        echo "  1) All events (conversation end, file edits, commits)"
        echo "  2) Conversation end only"
        echo "  3) File edits and commits only"
        local hook_choice
        hook_choice="$(prompt "Select option [1-3]" "1")"

        local triggers="stop,edit,commit"
        case "$hook_choice" in
            "1") triggers="stop,edit,commit" ;;
            "2") triggers="stop" ;;
            "3") triggers="edit,commit" ;;
        esac
        config_set_value "hooks.triggers" "$triggers"
    else
        config_set_value "hooks.enabled" "false"
    fi
else
    color_dim "Claude Code CLI not detected - skipping hooks setup"
    color_dim "Install Claude Code and run 'backup-config set hooks.enabled true' later"
    config_set_value "hooks.enabled" "false"
fi
```

This section should gracefully handle missing Claude CLI.
  </action>
  <verify>grep -q "Claude Code Integration" bin/backup-config.sh && grep -q "hooks.enabled" bin/backup-config.sh</verify>
  <done>Wizard includes Claude hooks setup with CLI detection</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] mode_wizard() includes cloud folder setup section
- [ ] mode_wizard() includes alerts/notifications section
- [ ] mode_wizard() includes Claude hooks section (with graceful CLI detection)
- [ ] Wizard runs without errors: bash bin/backup-config.sh wizard (can exit early)
- [ ] bash -n bin/backup-config.sh passes
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Wizard covers all major v1.0 and v1.1 features
- New users get guided setup for complete configuration
</success_criteria>

<output>
After completion, create `.planning/phases/09-configuration-ux/09-02-SUMMARY.md`
</output>
